% close all;
clear;
SetupPath;
clear global;

f0 = 31e9;
c0 = Constants.c0;
l0 = c0/f0;
z0 = Constants.z0;

dx = 0.45*l0;
dy = dx;
wslot = 0.05*l0;
dslot = 0.05*l0;
walled = 0;
dedge = 0.25*l0;
zfeed = 100;

f = 12e9;
th = eps * pi/180;
ph = 0   * pi/180;

kx = [-25111.2683815662 - 2.51327412287183i	-25004.8482523272 - 2.51327412287183i	-24793.1424441439 - 2.51327412287183i	-24483.2032062142 - 2.51327412287183i	-24092.5690161170 - 2.51327412287183i	-23639.6165500969 - 2.51327412287183i	-23141.8867617472 - 2.51327412287183i	-22619.7184332588 - 2.51327412287183i	-22097.5501047704 - 2.51327412287183i	-21599.8203164207 - 2.51327412287183i	-21146.8678504006 - 2.51327412287183i	-20756.2336603034 - 2.51327412287183i	-20446.2944223737 - 2.51327412287183i	-20234.5886141904 - 2.51327412287183i	-20128.1684849514 - 2.51327412287183i	-20085.2227906471 - 2.51327412287183i	-19978.8026614081 - 2.51327412287183i	-19767.0968532248 - 2.51327412287183i	-19457.1576152951 - 2.51327412287183i	-19066.5234251979 - 2.51327412287183i	-18613.5709591778 - 2.51327412287183i	-18115.8411708281 - 2.51327412287183i	-17593.6728423397 - 2.51327412287183i	-17071.5045138513 - 2.51327412287183i	-16573.7747255016 - 2.51327412287183i	-16120.8222594815 - 2.51327412287183i	-15730.1880693843 - 2.51327412287183i	-15420.2488314546 - 2.51327412287183i	-15208.5430232713 - 2.51327412287183i	-15102.1228940323 - 2.51327412287183i	-15059.1771997280 - 2.51327412287183i	-14952.7570704890 - 2.51327412287183i	-14741.0512623057 - 2.51327412287183i	-14431.1120243760 - 2.51327412287183i	-14040.4778342788 - 2.51327412287183i	-13587.5253682587 - 2.51327412287183i	-13089.7955799090 - 2.51327412287183i	-12567.6272514206 - 2.51327412287183i	-12045.4589229322 - 2.51327412287183i	-11547.7291345825 - 2.51327412287183i	-11094.7766685624 - 2.51327412287183i	-10704.1424784652 - 2.51327412287183i	-10394.2032405355 - 2.51327412287183i	-10182.4974323522 - 2.51327412287183i	-10076.0773031132 - 2.51327412287183i	-10033.1316088089 - 2.51327412287183i	-9926.71147956989 - 2.51327412287183i	-9715.00567138659 - 2.51327412287183i	-9405.06643345694 - 2.51327412287183i	-9014.43224335969 - 2.51327412287183i	-8561.47977733964 - 2.51327412287183i	-8063.74998898990 - 2.51327412287183i	-7541.58166050151 - 2.51327412287183i	-7019.41333201313 - 2.51327412287183i	-6521.68354366339 - 2.51327412287183i	-6068.73107764334 - 2.51327412287183i	-5678.09688754609 - 2.51327412287183i	-5368.15764961644 - 2.51327412287183i	-5156.45184143314 - 2.51327412287183i	-5050.03171219411 - 2.51327412287183i	-5007.08601788983 - 2.51327412287183i	-4900.66588865079 - 2.51327412287183i	-4688.96008046750 - 2.51327412287183i	-4379.02084253784 - 2.51327412287183i	-3988.38665244060 - 2.51327412287183i	-3535.43418642055 - 2.51327412287183i	-3037.70439807081 - 2.51327412287183i	-2515.53606958242 - 2.51327412287183i	-1993.36774109403 - 2.51327412287183i	-1495.63795274429 - 2.51327412287183i	-1042.68548672424 - 2.51327412287183i	-652.051296626997 - 2.51327412287183i	-342.112058697343 - 2.51327412287183i	-130.406250514045 - 2.51327412287183i	-23.9861212750116 - 2.51327412287183i	-2.49179912822023 - 2.49179912822023i	-2.38536835590396 - 2.38536835590396i	-2.17364137502258 - 2.17364137502258i	-1.86367114006943 - 1.86367114006943i	-1.47299788264644 - 1.47299788264644i	-1.02000011684981 - 1.02000011684981i	-0.522220550543440 - 0.522220550543440i	0.00000000000000 + 0.00000000000000i	0.522220550543440 + 0.522220550543440i	1.02000011684981 + 1.02000011684981i	1.47299788264644 + 1.47299788264644i	1.86367114006943 + 1.86367114006943i	2.17364137502258 + 2.17364137502258i	2.38536835590396 + 2.38536835590396i	2.49179912822023 + 2.49179912822023i	23.9861212750116 + 2.51327412287183i	130.406250514045 + 2.51327412287183i	342.112058697343 + 2.51327412287183i	652.051296626997 + 2.51327412287183i	1042.68548672424 + 2.51327412287183i	1495.63795274429 + 2.51327412287183i	1993.36774109403 + 2.51327412287183i	2515.53606958242 + 2.51327412287183i	3037.70439807080 + 2.51327412287183i	3535.43418642055 + 2.51327412287183i	3988.38665244059 + 2.51327412287183i	4379.02084253784 + 2.51327412287183i	4688.96008046750 + 2.51327412287183i	4900.66588865079 + 2.51327412287183i	5007.08601788983 + 2.51327412287183i	5050.03171219411 + 2.51327412287183i	5156.45184143314 + 2.51327412287183i	5368.15764961644 + 2.51327412287183i	5678.09688754609 + 2.51327412287183i	6068.73107764334 + 2.51327412287183i	6521.68354366338 + 2.51327412287183i	7019.41333201313 + 2.51327412287183i	7541.58166050151 + 2.51327412287183i	8063.74998898990 + 2.51327412287183i	8561.47977733964 + 2.51327412287183i	9014.43224335969 + 2.51327412287183i	9405.06643345694 + 2.51327412287183i	9715.00567138659 + 2.51327412287183i	9926.71147956989 + 2.51327412287183i	10033.1316088089 + 2.51327412287183i	10076.0773031132 + 2.51327412287183i	10182.4974323522 + 2.51327412287183i	10394.2032405355 + 2.51327412287183i	10704.1424784652 + 2.51327412287183i	11094.7766685624 + 2.51327412287183i	11547.7291345825 + 2.51327412287183i	12045.4589229322 + 2.51327412287183i	12567.6272514206 + 2.51327412287183i	13089.7955799090 + 2.51327412287183i	13587.5253682587 + 2.51327412287183i	14040.4778342788 + 2.51327412287183i	14431.1120243760 + 2.51327412287183i	14741.0512623057 + 2.51327412287183i	14952.7570704890 + 2.51327412287183i	15059.1771997280 + 2.51327412287183i	15102.1228940323 + 2.51327412287183i	15208.5430232713 + 2.51327412287183i	15420.2488314546 + 2.51327412287183i	15730.1880693843 + 2.51327412287183i	16120.8222594815 + 2.51327412287183i	16573.7747255016 + 2.51327412287183i	17071.5045138513 + 2.51327412287183i	17593.6728423397 + 2.51327412287183i	18115.8411708281 + 2.51327412287183i	18613.5709591778 + 2.51327412287183i	19066.5234251979 + 2.51327412287183i	19457.1576152951 + 2.51327412287183i	19767.0968532248 + 2.51327412287183i	19978.8026614081 + 2.51327412287183i	20085.2227906471 + 2.51327412287183i	20128.1684849514 + 2.51327412287183i	20234.5886141904 + 2.51327412287183i	20446.2944223737 + 2.51327412287183i	20756.2336603034 + 2.51327412287183i	21146.8678504006 + 2.51327412287183i	21599.8203164207 + 2.51327412287183i	22097.5501047704 + 2.51327412287183i	22619.7184332588 + 2.51327412287183i	23141.8867617472 + 2.51327412287183i	23639.6165500969 + 2.51327412287183i	24092.5690161170 + 2.51327412287183i	24483.2032062142 + 2.51327412287183i	24793.1424441439 + 2.51327412287183i	25004.8482523272 + 2.51327412287183i	25111.2683815662 + 2.51327412287183i];

[k0, ~, ~, ~] = k(f, 1, th, ph);

D = 1./(z0*k0) .* (k0.^2-kx.^2) .* besselj(0,    wslot/4 .* -1j.*sqrt(-(k0.^2-kx.^2))) .* ...
                                   besselh(0, 2, wslot/4 .* -1j.*sqrt(-(k0.^2-kx.^2)));
D = 1./(z0*k0) .* (k0.^2-kx.^2) .* besselj(0,    wslot/4 .* sqrt(k0.^2-kx.^2)) .* ...
                                   besselh(0, 2, wslot/4 .* sqrt(k0.^2-kx.^2));

figureex;
    plot(kx, real(D));
    plot(kx, imag(D));

